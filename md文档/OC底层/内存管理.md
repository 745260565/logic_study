### 一、内存五大区

iOS中，常说的堆区、栈区都是指的虚拟内存，主要分以下五大区

1. 堆区：由程序员分配和释放，用于存放运行中被动态分配的内存段，大小不定，可以增加或缩减，由低到高，在iOS的ARC程序中，系统自动管理计数器，计数器为0的时候，当次runloop结束后，释放掉内存。堆中的地址通过指针访问，要访问堆中内存时，一般先需要通过栈区的指针地址，然后通过指针地址访问堆区，OC中使用`alloc`或者`new`开辟空间创建对象，C语言中使用`mallo、calloc、realloc`分配空间，`free`释放，一般0x6开头
2. 栈区：栈由编译器分配和释放，用于存方程序临时的变量，参数，局部变量等，是一块连续的内存区域，先进后出，由高向低，iOS主线栈大小是`1MB`，其它线程是`512KB`，一般0x7开头
3. 全局区（静态区）：全局区分为未初始化区：bss段和初始化全局区：data段，一般0x1开头
4. 常量区：存放`常量`,已初始化的全局变量，已初始化的静态变量，空间由系统管理，生命周期为整个程序运行期，一般0x1开头
5. 代码区：存放函数的二进制代码

### 二、iOS内存优化的方案

2.1、nonopointerISA: 0:纯isa指针，1:不止是类对象地址，isa包含类信息、对象的引用计数等

2.2、tagged point：5S之后的一种优化，小对象类型 NSNumber  NSData  NSString，打上tagged标签后，不再是地址，而是真正的值

先关闭ARC，build setting -> Language - Reference Counting - NO

```objective-c
    NSString *firstString = @"helloworld";
    NSString *secondString = [NSString stringWithFormat:@"helloworld"];
    NSString *thirdString = @"hello";
    NSString *fourthString = [NSString stringWithFormat:@"hello"];
    
    NSLog(@"%p %@",firstString,[firstString class]);
    NSLog(@"%p %@",secondString,[secondString class]);
    NSLog(@"%p %@",thirdString,[thirdString class]);
    NSLog(@"%p %@",fourthString,[fourthString class]);
   
   打印输出
   	2022-07-27 16:12:41.065277+0800 OCTest[53504:3088675] 0x100a7c070 __NSCFConstantString
    2022-07-27 16:12:41.065357+0800 OCTest[53504:3088675] 0x282c556a0 __NSCFString
  	2022-07-27 16:12:41.065386+0800 OCTest[53504:3088675] 0x100a7c090 __NSCFConstantString
  	2022-07-27 16:12:41.065410+0800 OCTest[53504:3088675] 0xb3a7ee3798a9d5ec NSTaggedPointerString
```

NSCFConstantString：常量区

NSCFString：长字符串通过StringWithFormat创建时会出现，引用计数为1

NSTaggedPointerString：字符串长度小于9时自动生成

2.3、sidetable

